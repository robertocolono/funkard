// prisma/schema.prisma

datasource db {
  provider = "sqlite" // usa "postgresql" quando torneremo su Neon
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  handle    String   @unique
  rating    Float?
  country   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products  Product[]
}

model Product {
  id           String       @id @default(cuid())
  title        String
  type         ProductType
  tcg          String
  setName      String?
  releaseYear  Int?
  rarity       String?
  edition      String?
  isSealed     Boolean
  condition    Condition?
  priceEUR     Int
  quantity     Int
  imageUrl     String
  description  String?
  metadata     Json?
  sellerId     String
  seller       User         @relation(fields: [sellerId], references: [id])
  priceHistory PriceHistory[]
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  @@index([type, priceEUR])
  @@index([tcg, setName])
}

model PriceHistory {
  id         String    @id @default(cuid())
  productId  String
  product    Product   @relation(fields: [productId], references: [id])
  date       DateTime  @default(now())
  priceEUR   Int
  source     String?
  note       String?
}

enum ProductType {
  SINGLE
  BOOSTER
  BOX
  ETB
  TIN
  DECK
  COLLECTION
  ACCESSORY
  PROMO
}

enum Condition {
  MINT
  NEAR_MINT
  LIGHT_PLAYED
  PLAYED
  POOR
}